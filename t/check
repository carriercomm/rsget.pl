#!/usr/bin/perl

use strict;
use warnings;
use URI::Escape;

my $file = undef;
while ( <> ) {
	if ( /^DONE:(?: | .+ )fname=(\S+) / ) {
		$file = uri_unescape( $1 );
	} elsif ( s/^#\s*md5sum:\s*// ) {
		my $md5 = `md5sum $file`;
		if ( $md5 ne $_ ) {
			print "md5 mismatch:\n";
			print "-$_";
			print "+$md5\n";
		} else {
			print "OK: $file\n";
		}
	}
}
